# Falsification Debugger Configuration
# Reference: docs/falsification-debugger-architecture.md
# Compatible with UnifiedConfig (scripts/parallel_test/unified_config.py)

hypothesis_management:
  max_concurrent: 5           # Maximum hypotheses to test simultaneously
  min_hypotheses: 2           # Minimum hypotheses before starting tests
  require_falsifiability: true

  ranking_weights:
    probability: 0.5          # Weight for likelihood score
    impact: 0.3               # Weight for severity score
    complexity: -0.2          # Weight for test complexity (negative = prefer simple)

  validation_rules:
    require_test_strategy: true
    require_expected_behavior: true
    min_test_time: 1.0        # Minimum seconds for valid test

worktree_orchestration:
  base_dir: "../worktrees"    # Relative to project root
  branch_prefix: "hyp"        # Branches: hyp-1, hyp-2, ...
  auto_cleanup: true          # Cleanup after testing
  preserve_on_error: false    # Keep worktrees if tests fail (for debugging)
  use_pool: true              # Use worktree pool for efficiency
  pool_size: 10               # Number of pre-created worktrees

test_execution:
  default_timeout: 300        # Seconds (5 minutes)
  min_parallel_time: 60       # Only parallelize if test >= 60s
  max_concurrent_tests: 5     # Maximum tests running simultaneously
  test_command: "pytest"      # Default test command
  capture_stdout: true
  capture_stderr: true
  collect_metrics: true
  use_async: true             # Use async execution when possible

  overhead:
    worktree_creation: 8.0    # Seconds
    session_startup: 5.0      # Seconds
    context_building: 20.0    # Seconds - Claude understanding context
    environment_setup: 5.0    # Seconds
    merge_per_branch: 10.0    # Seconds per branch merge
    conflict_resolution: 60.0 # Seconds base time for conflict resolution
    cleanup: 3.0              # Seconds

results_analysis:
  confidence_threshold: 0.7   # Minimum confidence for definitive result
  session_persistence: true   # Use memory MCP
  report_format: "markdown"   # markdown | json | text

  classification_rules:
    falsified:
      exit_code: 0
      min_confidence: 0.7
    supported:
      exit_code: [1, 2]       # Non-zero indicates bug reproduced
      min_confidence: 0.7
    inconclusive:
      conditions:
        - timeout
        - error
        - confidence < 0.7

# Task Splitting and Parallelization Optimization
task_splitting:
  # Resource limits
  max_concurrent_sessions: 8  # Maximum parallel Claude sessions
  max_worktrees: 15           # Maximum git worktrees per repo
  min_files_per_subtask: 2    # Minimum files to justify a subtask
  min_task_complexity: 0.2    # Minimum complexity (0.0-1.0) to consider splitting

  # Break-even thresholds (minutes)
  # Tasks shorter than these should NOT be split
  min_task_time_for_splits:
    2: 5.0    # 2-way split requires >5 min task
    3: 12.0   # 3-way split requires >12 min task
    4: 20.0   # 4-way split requires >20 min task
    5: 30.0   # 5+ way split requires >30 min task

  # Complexity scoring weights
  complexity_weights:
    file_modify: 0.15         # Per file to modify
    file_create: 0.10         # Per file to create
    loc_estimate: 0.001       # Per estimated line of code
    dependency: 0.05          # Per cross-file dependency

agent_integration:
  # SuperClaude Agent Integration
  root_cause_analyst:
    enabled: true
    purpose: "Generate initial hypothesis pool"
    agent_skill: "/sc:root-cause"

  sequential_thinking_mcp:
    enabled: true
    use_for_ranking: true
    purpose: "Structured reasoning for hypothesis ranking"

  quality_engineer:
    enabled: true
    validate_tests: true
    purpose: "Validate test quality and coverage"

  parallel_orchestrator:
    enabled: true
    scripts_path: "~/klauspython/parallel-orchestrator/scripts"
    purpose: "Leverage existing worktree infrastructure"

  memory_mcp:
    enabled: true
    session_prefix: "falsification"
    purpose: "Session persistence and state management"

# Analysis and Implementation Workflow
analysis_workflow:
  analyze_tool:
    enabled: true
    agent_skill: "/sc:analyze"
    purpose: "Comprehensive code analysis of supported hypothesis"

  troubleshoot_tool:
    enabled: true
    agent_skill: "/sc:troubleshoot"
    purpose: "Diagnose and debug the identified root cause"

  design_tool:
    enabled: true
    agent_skill: "/sc:design"
    purpose: "Design fix architecture and solution approach"

  implement_tool:
    enabled: true
    agent_skill: "/sc:implement"
    purpose: "Implement the proposed solution"

# Logging
logging:
  level: "INFO"               # DEBUG, INFO, WARNING, ERROR, CRITICAL
  file: "falsification.log"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# Session Management
session:
  auto_save: true
  save_interval: 300          # Seconds
  preserve_artifacts: true
  artifact_dir: ".falsification_artifacts"

# Paths (optional - defaults to current directory)
paths:
  project_root: "."
  output_dir: "."
  config_file: ""
  artifact_dir: ".falsification_artifacts"
